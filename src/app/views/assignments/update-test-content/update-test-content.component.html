<section class="update__sec">
  <div class="container">
    <div class="row">
      <h2 class="col-10">{{ questionPaper.name }}</h2>
    </div>

    <hr />
    <div class="row">
      <div class="col text-left">
        <button mat-raised-button class="add-btn mx-2" (click)="editTest()">
          <mat-icon>edit</mat-icon><span class="ml-2">Edit Test</span>
        </button>
      </div>
      <div class="col text-right">
        <button *ngIf="quest?.status == 'DRAFT'" mat-raised-button  class="add-btn mx-2" (click)="initiateVerification()">
          <span class="ml-2">Initiate verification</span>
        </button>
        <button
          *ngIf="quest?.status == 'PENDING_VERIFICATION'"
          mat-raised-button
          class="add-btn mx-2"
          (click)="verifyReject()"
        >
          <span class="ml-2">Verify?</span>
        </button>
        <button
          *ngIf="quest?.status == 'VERIFIED'"
          mat-raised-button
          class="add-btn mx-2"
          (click)="publishstatus()"
        >
          <span class="ml-2">Publish</span>
        </button>
        <button
          *ngIf="quest?.status == 'PUBLISHED'"
          mat-raised-button
          class="add-btn mx-2"
          (click)="archive()"
        >
          <span class="ml-2">Archive</span>
        </button>

        <button
          mat-raised-button
          class="add-btn mx-2"
          *ngIf="status == 'PUBLISHED'"
          (click)="viewAssignment()"
        >
          <mat-icon>add_circle</mat-icon
          ><span class="ml-2">View Assignment</span>
        </button>

        <button
          mat-raised-button
          class="add-btn mx-2"
          (click)="addSection()"
          *ngIf="
            totalDurationOfSections < totalTestDuration &&
            status !== 'PUBLISHED'
          "
        >
          <mat-icon>add_circle</mat-icon><span class="ml-2">Add Section</span>
        </button>
      </div>
    </div>
    <div class="text-right py-4">
      <div class="row text-right">
        <div class="col-5" style="text-align: left">
          <button
            class="btn btn-primary d-inline-block border-0"
            *ngIf="quest != null"
          >
            {{ quest?.status }}</button
          ><i
            *ngIf="remarks != '' && remarks != null && status == 'DRAFT'"
            matTooltip="{{ remarks }}"
            class="fas fa-info-circle fa-1x"
          ></i>
        </div>
        <div class="col-4">
          <h5>
            Total Duration of sections : {{ totalDurationOfSections }} mins
          </h5>
        </div>
        <div class="col-3">
          <h5>Total Test Duration : {{ totalTestDuration }} mins</h5>
        </div>
      </div>
    </div>
    <mat-accordion *ngIf="modelsections?.length > 0">
      <div
        class="row"
        *ngFor="let section of modelsections; let i = index"
        style="margin-bottom: 20px"
      >
        <div class="col-lg-12">
          <mat-expansion-panel [expanded]="expandedStateArray[i]">
            <mat-expansion-panel-header (click)="getSectionId(section, i)">
              <mat-panel-title class="position-relative">
                <span class=""
                  ><strong>{{ section.name }}</strong>
                </span>
              </mat-panel-title>

              <p class="sectionDuration__p">
                Section Duration : {{ section.durationInMinutes }} mins
              </p>

            </mat-expansion-panel-header>
            <h2 class="text-center">Question List</h2>

            <div class="row">
              <div class="col-lg-6">
                <div class="search-bar">
                  <mat-form-field style="width: 600px" appearance="outline">
                    <mat-label>
                      {{ "COMMON_TAG.FILTER" | translate }}</mat-label
                    >
                    <input
                      matInput
                      placeholder="Search Questions"
                      #input
                      (keyup)="applyFilter($event)"
                    />
                  </mat-form-field>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="btn__group">
                  <button
                    mat-raised-button
                    class="add-btn mx-2"
                    (click)="openQuestionList()"
                    *ngIf="status !== 'PUBLISHED'"
                  >
                    <mat-icon>add_circle</mat-icon><span class="ml-2">Add</span>
                  </button>
                  <button
                    mat-raised-button
                    class="add-btn mx-2"
                    (click)="deleteQuestionFromSection()"
                    *ngIf="status !== 'PUBLISHED'"
                  >
                    <mat-icon>delete</mat-icon><span class="ml-2">Delete</span>
                  </button>
                </div>
              </div>
            </div>



            <div cdkDropList class="section-question-list" (cdkDropListDropped)="drop($event)">
              <div class="question-box">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-lg-1" style="    max-width: 50px;">
                      <div>
                        <mat-checkbox
                          (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate] ="
                            selection.hasValue() && !isAllSelected() " >
                        </mat-checkbox>
                      </div>
                    </div>
                    <div class="col-lg-8">
                      <div class="question-list-header">NAME</div>
                    </div>
                    <div class="col-lg-1">
                      <div class="question-list-header">POSITIVE MARK</div>
                    </div>
                    <div class="col-lg-1">
                      <div class="question-list-header">NEGATIVE MARK</div>
                    </div>
                    <div class="col-lg-1">
                      <div class="question-list-header">SKIP MARK</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section-question-list-content">
                <div class="question-box " *ngFor="let sectionQuestion of sectionQuestionList" cdkDrag>
                  <div class="question-box-custom-placeholder" *cdkDragPlaceholder></div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-lg-1" style="    max-width: 50px;">
                        <div>
                          <mat-checkbox
                            (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(sectionQuestion) : null"
                            [checked]="selection.isSelected(sectionQuestion)">
                          </mat-checkbox>
                        </div>
                      </div>
                      <div class="col-lg-8">
                        <div class="question-name-div" [innerHTML]="sectionQuestion.name"></div>
                      </div>
                      <div class="col-lg-1">
                        <div>{{sectionQuestion.positiveMark}}</div>
                      </div>
                      <div class="col-lg-1">
                        <div>{{sectionQuestion.negativeMark}}</div>
                      </div>
                      <div class="col-lg-1">
                        <div>{{sectionQuestion.skipMark}}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="question-box">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="question-list-header" style="float: right;">
                        Total number of Questions : {{ sectionQuestionList ? sectionQuestionList.length : 0 }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </div>

        <div class="col-lg-1" style="margin-top: 10px" *ngIf="status !== 'PUBLISHED'">
          <button class="edit__btn"
            mat-mini-fab color="" (click)="editSection(section)" >
            <mat-icon>edit</mat-icon>
          </button>
          <button  class="remove__btn"
            mat-mini-fab color=""  (click)="removeSection(section)" >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </mat-accordion>
  </div>
</section>
